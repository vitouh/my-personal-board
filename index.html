<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>/who's vito?/</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#f6efe8;
  color:#000;
  font-family: Arial, Helvetica, sans-serif;
  margin:0;
  padding:12px;
}
h1,h2,h3{margin:6px 0}
.board{
  max-width:900px;
  margin:auto;
}
.comment{
  border:2px solid #aaa;
  background:#fff;
  padding:6px;
  margin:6px 0;
  font-size:14px;
}
.reply{
  margin-left:24px;
  border-left:3px solid #ccc;
}
.meta{
  font-size:12px;
  color:#555;
}
button{
  font-size:12px;
  margin-right:6px;
  cursor:pointer;
}
textarea,input{
  width:100%;
  font-size:14px;
  margin:4px 0;
}
.reply-box{
  margin-top:6px;
}
</style>
</head>

<body>
<div class="board">

<h1>/whoâ€™s vito?/</h1>

<p><b>Heya!! Iâ€™m Don V!</b> More formally, Don Vito. Call me Don, Vito, or V â€” vibes only.</p>

<hr>

<h2>Leave a comment</h2>
<input id="nameInput" placeholder="Your name (optional)">
<textarea id="commentInput" placeholder="Say somethingâ€¦"></textarea>
<button onclick="postComment()">Post</button>

<hr>

<h2>Comments</h2>
<div id="comments"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, collection, addDoc, query,
  orderBy, onSnapshot, serverTimestamp,
  deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ðŸ”¥ Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyBUxo-7rLsYMjjOSQDYczqwcrh_pyX7D1o",
  authDomain: "vito-board.firebaseapp.com",
  projectId: "vito-board",
  storageBucket: "vito-board.firebasestorage.app",
  messagingSenderId: "15417026348",
  appId: "1:15417026348:web:0b5f8ed7b101af0c842e89"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ðŸ‘¤ visitor ID (for delete permissions) */
let uid = localStorage.getItem("uid");
if(!uid){
  uid = crypto.randomUUID();
  localStorage.setItem("uid", uid);
}

/* ðŸ“¤ post main comment */
window.postComment = async () => {
  const text = commentInput.value.trim();
  if(!text) return;

  const name = nameInput.value.trim();

  await addDoc(collection(db,"comments"),{
    text,
    name,
    uid,
    parent: null,
    time: serverTimestamp()
  });

  commentInput.value="";
};

/* ðŸ“¥ render comments */
const q = query(collection(db,"comments"), orderBy("time","asc"));
onSnapshot(q, snap=>{
  const list=[];
  snap.forEach(d=>list.push({id:d.id,...d.data()}));
  render(list);
});

function render(list){
  comments.innerHTML="";
  list.filter(c=>!c.parent).forEach(c=>{
    comments.appendChild(buildComment(c,list));
  });
}

function buildComment(c,list){
  const div=document.createElement("div");
  div.className="comment";

  const name = c.name || "Anonymous";

  div.innerHTML=`
    <div class="meta"><b>${name}</b></div>
    <div>${c.text}</div>
  `;

  /* delete button (owner only) */
  if(c.uid===uid){
    const del=document.createElement("button");
    del.textContent="Delete";
    del.onclick=()=>deleteDoc(doc(db,"comments",c.id));
    div.appendChild(del);
  }

  /* reply button */
  const replyBtn=document.createElement("button");
  replyBtn.textContent="Reply";
  div.appendChild(replyBtn);

  const box=document.createElement("div");
  box.className="reply-box";
  box.style.display="none";
  box.innerHTML=`
    <textarea placeholder="Replyâ€¦"></textarea>
    <button>Send</button>
  `;
  div.appendChild(box);

  replyBtn.onclick=()=>box.style.display =
    box.style.display==="none"?"block":"none";

  box.querySelector("button").onclick=async()=>{
    const txt=box.querySelector("textarea").value.trim();
    if(!txt) return;

    const nameInputVal = nameInput.value.trim();

    await addDoc(collection(db,"comments"),{
      text:txt,
      name: nameInputVal || c.name || "Anonymous",
      uid,
      parent:c.id,
      time:serverTimestamp()
    });

    box.querySelector("textarea").value="";
    box.style.display="none";
  };

  /* replies */
  list.filter(r=>r.parent===c.id).forEach(r=>{
    const rd=document.createElement("div");
    rd.className="comment reply";
    rd.innerHTML=`
      <div class="meta"><b>${r.name||"Anonymous"}</b></div>
      <div>${r.text}</div>
    `;
    if(r.uid===uid){
      const d=document.createElement("button");
      d.textContent="Delete";
      d.onclick=()=>deleteDoc(doc(db,"comments",r.id));
      rd.appendChild(d);
    }
    div.appendChild(rd);
  });

  return div;
}
</script>

</body>
</html>
